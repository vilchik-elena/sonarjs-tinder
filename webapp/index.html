<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
  import { getDatabase, set, ref, onValue } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";

const firebaseConfig = {
  apiKey: window.API_KEY,
  authDomain: "sonarjs-tinder.firebaseapp.com",
  databaseURL: "https://sonarjs-tinder-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "sonarjs-tinder",
  storageBucket: "sonarjs-tinder.appspot.com",
  messagingSenderId: "166820050700",
  appId: "1:166820050700:web:6a1ff6447ddac896db3b29"
};
  const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

async function getIssues() {
  return new Promise((resolve, reject) => {
    const starCountRef = ref(db, 'issues/');

    onValue(starCountRef, (snapshot) => {
      const data = snapshot.val();
      resolve(data)
    });
  });
}

function writeIssue(issue, qualification) {
  set(ref(db, 'issues/' + 0), {
    ...issue,
    qualification
  });

  console.log("wrote value", qualification);
}

console.log("starting")
const issues = await getIssues()
console.log(`found ${issues.length} issues`)

const issue = issues[0]
console.log(issue)

window.truePositive = () => writeIssue(issue, true);
window.falsePositive = () => writeIssue(issue, false);

document.write(`
  <center>
    <a href="${issue.url}">${issue.rule}: ${issue.message}</a>
  </center>

  <ul>
    <li><a href="javascript:window.truePositive()">True positive</a></li>
    <li><a href="javascript:window.falsePositive()">False positive</a></li>
  </ul>
`);

</script>